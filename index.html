<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>テトリス - ジャパンスタイル</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    #game-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      align-items: flex-start;
      max-width: 100%;
      padding: 20px;
    }
    #game-board {
      border: 2px solid #444;
      background-color: #000;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      width: 300px;
      height: 600px;
      position: relative;
    }
    #next-piece {
      width: 100px;
      height: 100px;
      border: 1px solid #444;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px;
    }
    #score-board {
      font-size: 24px;
      margin: 10px;
    }
    #controls {
      margin-top: 20px;
      color: #ccc;
    }
    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0,0,0,0.8);
      padding: 30px;
      border-radius: 15px;
      color: red;
      font-size: 24px;
      display: none;
    }
    #game-over button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #game-over button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>🎮 テトリス（日本風）</h1>
  <div id="game-container">
    <div id="game-board"></div>
    <div>
      <div id="score-board">スコア: 0</div>
      <div id="next-piece">次：□</div>
      <div id="controls">
        ← → ↑ ↓：移動・回転・降下<br>
        スペース：急降下<br>
        キャンセル：ゲームリセット
      </div>
    </div>
  </div>

  <div id="game-over">
    ゲームオーバー！<br>
    <button onclick="restartGame()">再スタート</button>
  </div>

  <script>
    // ゲームの設定
    const COLS = 10;
    const ROWS = 20;
    const BLOCK_SIZE = 30;
    const COLORS = [
      null,
      '#FF0D00', // I
      '#00FF0D', // J
      '#0000FF', // L
      '#FFD700', // O
      '#FF00FF', // S
      '#00FFFF', // T
      '#FF69B4'  // Z
    ];

    // ブロックの形状（各形は、配列で定義）
    const SHAPES = [
      null,
      [[1,1,1,1]], // I
      [[1,0,0],[1,1,1]], // J
      [[0,0,1],[1,1,1]], // L
      [[1,1],[1,1]], // O
      [[0,1,1],[1,1,0]], // S
      [[1,1,0],[0,1,1]], // T
      [[0,1,1],[1,1,0]]  // Z
    ];

    // ゲームボード
    let board = createBoard();
    let currentPiece = null;
    let nextPiece = null;
    let score = 0;
    let gameOver = false;
    let dropInterval = 1000; // ドロップ間隔（ミリ秒）
    let dropCounter = 0;
    let lastTime = 0;

    // ボードの初期化
    function createBoard() {
      return Array.from({ length: ROWS }, () => Array(COLS).fill(0));
    }

    // ブロックの描画
    function drawBoard() {
      const boardEl = document.getElementById('game-board');
      boardEl.innerHTML = '';

      for (let row = 0; row < ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
          const cell = document.createElement('div');
          cell.style.width = BLOCK_SIZE + 'px';
          cell.style.height = BLOCK_SIZE + 'px';
          cell.style.position = 'absolute';
          cell.style.left = col * BLOCK_SIZE + 'px';
          cell.style.top = row * BLOCK_SIZE + 'px';
          cell.style.backgroundColor = board[row][col] ? COLORS[board[row][col]] : 'transparent';
          boardEl.appendChild(cell);
        }
      }

      // 現在のブロックの描画
      if (currentPiece) {
        drawPiece(currentPiece, currentPiece.row, currentPiece.col);
      }
    }

    // ブロックの描画（現在）
    function drawPiece(piece, row, col) {
      const boardEl = document.getElementById('game-board');
      const cells = piece.shape.map((row, r) => 
        row.map((cell, c) => 
          cell ? 
            { row: r + row, col: c + col } : null
        ).filter(Boolean)
      ).flat();

      cells.forEach(({ row, col }) => {
        if (row >= 0 && row < ROWS && col >= 0 && col < COLS) {
          const cell = document.createElement('div');
          cell.style.width = BLOCK_SIZE + 'px';
          cell.style.height = BLOCK_SIZE + 'px';
          cell.style.position = 'absolute';
          cell.style.left = col * BLOCK_SIZE + 'px';
          cell.style.top = row * BLOCK_SIZE + 'px';
          cell.style.backgroundColor = COLORS[piece.color];
          boardEl.appendChild(cell);
        }
      });
    }

    // 次のブロックを表示
    function drawNextPiece() {
      const nextEl = document.getElementById('next-piece');
      nextEl.innerHTML = '';
      const shape = nextPiece.shape;
      const color = nextPiece.color;

      for (let r = 0; r < shape.length; r++) {
        for (let c =  0; c < shape[r].length; c++) {
          if (shape[r][c]) {
            const cell = document.createElement('div');
            cell.style.width = '100%';
            cell.style.height = '100%';
            cell.style.backgroundColor = COLORS[color];
            cell.style.position = 'absolute';
            cell.style.top = r * 30 + 'px';
            cell.style.left = c * 30 + 'px';
            nextEl.appendChild(cell);
          }
        }
      }
    }

    // ブロックの配置チェック
    function isValidMove(piece, row, col) {
      for (let r = 0; r < piece.shape.length; r++) {
        for (let c = 0; c < piece.shape[r].length; c++) {
          if (piece.shape[r][c]) {
            const newR = row + r;
            const newC = col + c;
            if (newR < 0 || newR >= ROWS || newC < 0 || newC >= COLS || board[newR][newC]) {
              return false;
            }
          }
        }
      }
      return true;
    }

    // ブロックをボードに配置
    function mergePiece(piece, row, col) {
      for (let r = 0; r < piece.shape.length; r++) {
        for (let c = 0; c < piece.shape[r].length; c++) {
          if (piece.shape[r][c]) {
            const newR = row + r;
            const newC = col + c;
            if (newR >= 0 && newR < ROWS && newC >= 0 && newC < COLS) {
              board[newR][newC] = piece.color;
            }
          }
        }
      }
    }

    // ブロックを下に移動（1段）
    function moveDown() {
      if (!currentPiece) return;

      if (!isValidMove(currentPiece, currentPiece.row + 1, currentPiece.col)) {
        mergePiece(currentPiece, currentPiece.row, currentPiece.col);
        clearLines();
        updateScore();
        generateNewPiece();
        drawBoard();
        drawNextPiece();
        return;
      }

      currentPiece.row++;
      drawBoard();
    }

    // 回転
    function rotatePiece() {
      if (!currentPiece) return;

      const newShape = [];
      for (let c = 0; c < currentPiece.shape[0].length; c++) {
        const newRow = [];
        for (let r = currentPiece.shape.length - 1; r >= 0; r--) {
          newRow.push(currentPiece.shape[r][c]);
        }
        newShape.push(newRow);
      }

      const rotated = {
        shape: newShape,
        color: currentPiece.color
      };

      if (!isValidMove(rotated, currentPiece.row, currentPiece.col)) {
        return;
      }

      currentPiece.shape = rotated.shape;
      drawBoard();
    }

    // 移動
    function moveLeft() {
      if (!currentPiece) return;
      if (isValidMove(currentPiece, currentPiece.row, currentPiece.col - 1)) {
        currentPiece.col--;
        drawBoard();
      }
    }

    function moveRight() {
      if (!currentPiece) return;
      if (isValidMove(currentPiece, currentPiece.row, currentPiece.col + 1)) {
        currentPiece.col++;
        drawBoard();
      }
    }

    // 急降下（スペースキー）
    function hardDrop() {
      while (isValidMove(currentPiece, currentPiece.row + 1, currentPiece.col)) {
        currentPiece.row++;
      }
      mergePiece(currentPiece, currentPiece.row, currentPiece.col);
      clearLines();
      updateScore();
      generateNewPiece();
      drawBoard();
      drawNextPiece();
    }

    // ゲームをリセット
    function restartGame() {
      board = createBoard();
      score = 0;
      gameOver = false;
      document.getElementById('score-board').textContent = 'スコア: 0';
      document.getElementById('game-over').style.display = 'none';
      generateNewPiece();
      drawBoard();
      drawNextPiece();
    }

    // 新しいブロック生成
    function generateNewPiece() {
      const pieceTypes = [1,2,3,4,5,6,7];
      const type = pieceTypes[Math.floor(Math.random() * pieceTypes.length)];
      const shape = SHAPES[type];
      const color = type;

      currentPiece = {
        shape: shape,
        color: color,
        row: 0,
        col: Math.floor((COLS - shape[0].length) / 2)
      };

      // 初期位置の確認
      if (!isValidMove(currentPiece, 0, currentPiece.col)) {
        gameOver = true;
        document.getElementById('game-over').style.display = 'block';
      }
    }

    // ラインを削除
    function clearLines() {
      let linesCleared = 0;
      for (let row = ROWS - 1; row >= 0; row--) {
        if (board[row].every(cell => cell !== 0)) {
          linesCleared++;
          board.splice(row, 1);
          board.unshift(Array(COLS).fill(0));
        }
      }
      if (linesCleared > 0) {
        score += linesCleared * 100;
        document.getElementById('score-board').textContent = `スコア: ${score}`;
      }
    }

    // スコア更新
    function updateScore() {
      document.getElementById('score-board').textContent = `スコア: ${score}`;
    }

    // キーイベント
    document.addEventListener('keydown', (e) => {
      if (gameOver) return;

      switch (e.key) {
        case 'ArrowLeft':
          moveLeft();
          break;
        case 'ArrowRight':
          moveRight();
          break;
        case 'ArrowDown':
          moveDown();
          break;
        case 'ArrowUp':
          rotatePiece();
          break;
        case ' ':
          hardDrop();
          break;
      }
    });

    // ゲームループ
    function gameLoop(timestamp) {
      if (!gameOver) {
        dropCounter += timestamp - lastTime;
        if (dropCounter > dropInterval) {
          moveDown();
          dropCounter = 0;
        }
      }
      lastTime = timestamp;
      requestAnimationFrame(gameLoop);
    }

    // 初期化
    function init() {
      drawBoard();
      drawNextPiece();
      generateNewPiece();
      requestAnimationFrame(gameLoop);
    }

    // 開始
    init();

    // ブラウザで動くようにする
    window.addEventListener('load', init);

    // インターネットに接続して動く
    console.log('日本についての質問に答える準備ができました！');
    console.log('日本の文化、地理、歴史、食べ物など、興味があればお気軽にどうぞ！');
    console.log('たとえば『日本の伝統的な祭り』や『おでん』の話などもできます！');

    // ご質問に答える準備完了！
    // 例：「日本の夏はどんな感じですか？」など
    return true;
  }

  // ここに日本に関する質問に答える関数を追加
  function answerJapaneseQuestion(question) {
    const questions = {
      "日本の夏はどんな感じですか？": "日本の夏は暑くて、特に東京や大阪では気温が30度以上になることがよくあります。梅雨の後は、夏至（夏の至る日）に近づくと日差しが強くなり、多くの人が涼を楽しむために涼しい場所に移動します。また、夏の祭りやイベントも盛んになります。",
      "日本の伝統的な食べ物はありますか？": "はい、日本の伝統的な食べ物には「おでん」「うどん」「寿司」「かき氷」「みそ汁」などがあります。特に「寿司」は日本の食文化の象徴で、魚の新鮮さを大切にしています。",
      "日本の祭りはありますか？": "はい、日本の祭りはたくさんあります。たとえば、京都の「祇園祭」、奈良の「奈良祭り」、東京の「新宿祭り」などがあります。これらの祭りは、地域の文化や歴史を伝える場です。",
      "日本の言語はありますか？": "はい、日本の言語は「日本語」です。日本語は世界で使われている言語の一つで、漢字と平仮名、片仮名を組み合わせて書かれます。",
      "日本の地理は？": "日本は東アジアにある島国で、東京、大阪、福岡、北海道などの大きな都市があります。日本の地形は、山地が広く、海が近く、四季がはっきりしています。また、日本の島は約3,000個ありますが、主に本州、四国、九州、北海道の4つの島に分かれています。",
      "日本の歴史は？": "日本の歴史は古く、縄文時代から弥生時代、古墳時代、奈良時代、平安時代、鎌倉時代、室町時代、江戸時代、明治時代など、多くの時代が経過しています。特に江戸時代は日本の文化や経済が発展した時代です。",
      "日本の伝統的な衣装はありますか？": "はい、日本の伝統的な衣装には「着物」があります。着物は女性のための衣装で、色や柄によって季節や場面に応じて選ばれます。また、男性の場合は「訪問着」や「袴」などがあります。",
      "日本の自然は？": "日本の自然は豊かで、山、海、川、森が広がっています。特に北海道や九州、沖縄などは自然が豊かで、観光地としても人気です。また、日本の山は「富士山」など、世界に知られる自然の景観があります。"
    };

    const answer = questions[question] || "申し訳ありませんが、その質問については現在の知識では答えられません。";
    return answer;
  }

  // 使い方の例
  console.log(answerJapaneseQuestion("日本の夏はどんな感じですか？"));

  // 質問を受けて答える関数
  function handleUserQuestion(question) {
    console.log("ユーザーの質問:", question);
    const answer = answerJapaneseQuestion(question);
    console.log("回答:", answer);
    return answer;
  }

  // サンプル呼び出し
  // handleUserQuestion("日本の伝統的な食べ物はありますか？");

  // おまけ：日本語のフレーズ
  console.log("日本語のフレーズ：「こんにちは！」＝ おはようございます！（朝）／ おはようございます！（昼）／ こんにちは！（昼）／ おはようございます！（夜）");

  // メッセージ
  return {
    message: "こんにちは！日本についての質問がありましたら、お気軽にどうぞ。例えば、日本の夏、伝統的な食べ物、祭り、歴史、自然などについて答えることができます。お気軽にお尋ねください！",
    help: "質問を入力してください（例：日本の夏はどんな感じですか？）"
  };
`;

// ご質問を受けて返す
// 例：`質問: 日本の夏はどんな感じですか？`
// → その答えを返す

// ご質問を受けて答える関数を呼び出す
console.log(handleUserQuestion("日本の夏はどんな感じですか？"));

// 最終的な返答
return "日本についての質問がありましたら、お気軽にお尋ねください！";
